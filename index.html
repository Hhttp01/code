<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Path Forge Pro - File System Engine</title>
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap');
        body { font-family: 'Inter', sans-serif; overflow: hidden; }
        .mono { font-family: 'Fira Code', monospace; }
        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        .context-menu { position: fixed; z-index: 1000; min-width: 180px; }
    </style>
</head>
<body class="bg-slate-950 text-slate-200">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const App = () => {
            const [projectName, setProjectName] = useState("");
            const [tree, setTree] = useState(null);
            const [pathInput, setPathInput] = useState("");
            const [editingFile, setEditingFile] = useState(null);
            const [isDarkMode, setIsDarkMode] = useState(true);
            const [contextMenu, setContextMenu] = useState(null);
            const [expandedFolders, setExpandedFolders] = useState(new Set(['root']));
            const [isExporting, setIsExporting] = useState(false);

            // --- Persistence (Local Storage) ---
            useEffect(() => {
                const saved = localStorage.getItem('pathforge_v3_data');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    setTree(parsed.tree);
                    setProjectName(parsed.projectName);
                }
            }, []);

            useEffect(() => {
                if (tree) {
                    localStorage.setItem('pathforge_v3_data', JSON.stringify({ tree, projectName }));
                }
                if (window.lucide) window.lucide.createIcons();
            }, [tree, projectName]);

            // --- REAL FILE SYSTEM ENGINE ---
            const exportToRealFiles = async () => {
                try {
                    if (!tree) return;
                    setIsExporting(true);
                    
                    // בחירת תיקייה במחשב
                    const rootHandle = await window.showDirectoryPicker();
                    
                    const processNode = async (node, parentHandle) => {
                        if (node.type === 'file') {
                            // סינון קבצים ריקים - כפי שביקשת
                            if (node.content && node.content.trim().length > 0) {
                                const fileHandle = await parentHandle.getFileHandle(node
