<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ProCode - Mobile Ready Editor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        .custom-scrollbar::-webkit-scrollbar { width: 6px; height: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #0d1117; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #30363d; border-radius: 10px; }
        .ltr { direction: ltr; text-align: left; }
        body { margin: 0; background-color: #0d1117; overscroll-behavior: none; }
        textarea { caret-color: #58a6ff; tab-size: 4; }
        
        /* התאמה למובייל - הסרגל הצידי הופך למגירה */
        @media (max-width: 768px) {
            .sidebar-mobile {
                position: fixed;
                right: 0;
                top: 0;
                bottom: 0;
                z-index: 50;
                transform: translateX(100%);
                transition: transform 0.3s ease;
            }
            .sidebar-open { transform: translateX(0); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const STORAGE_KEY = 'pro_code_files_v2';

        const Icon = ({ name, size = 18, className = "" }) => {
            const iconRef = useRef(null);
            useEffect(() => {
                if (iconRef.current && window.lucide) {
                    const icon = lucide[name] || lucide.File;
                    iconRef.current.innerHTML = lucide.createIcons({
                        icons: { [name]: icon }
                    });
                }
            }, [name]);
            return <i ref={iconRef} className={`inline-flex items-center justify-center ${className}`} style={{ width: size, height: size }}></i>;
        };

        const App = () => {
            const [files, setFiles] = useState(() => {
                const saved = localStorage.getItem(STORAGE_KEY);
                return saved ? JSON.parse(saved) : {
                    'index.js': '// Welcome to ProCode\nconsole.log("Hello Mobile!");',
                    'style.css': 'body { color: cyan; }'
                };
            });

            const [activeFile, setActiveFile] = useState(Object.keys(files)[0] || '');
            const [newFileName, setNewFileName] = useState('');
            const [isSidebarOpen, setSidebarOpen] = useState(window.innerWidth > 768);
            const [isSaving, setIsSaving] = useState(false);

            // שמירה אוטומטית עם חיווי ויזואלי
            useEffect(() => {
                setIsSaving(true);
                const timer = setTimeout(() => {
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(files));
                    setIsSaving(false);
                }, 500);
                return () => clearTimeout(timer);
            }, [files]);

            const createFile = () => {
                if (!newFileName.trim()) return;
                const name = newFileName.includes('.') ? newFileName : `${newFileName}.js`;
                setFiles(prev => ({ ...prev, [name]: '' }));
                setActiveFile(name);
                setNewFileName('');
                if (window.innerWidth <= 768) setSidebarOpen(false);
            };

            const deleteFile = (path, e) => {
                e.stopPropagation();
                if (confirm(`למחוק את ${path}?`)) {
                    const next = { ...files };
                    delete next[path];
                    setFiles(next);
                    if (activeFile === path) setActiveFile(Object.keys(next)[0] || '');
                }
            };

            return (
                <div className="flex h-screen w-screen overflow-hidden bg-[#0d1117] text-[#c9d1d9] font-sans">
                    
                    {/* Header - Mobile Only */}
                    <div className="md:hidden fixed top-0 left-0 right-0 h-14 bg-[#161b22] border-b border-[#30363d] flex items-center justify-between px-4 z-40">
                        <button onClick={() => setSidebarOpen(true)} className="p-2">
                            <Icon name="Menu" size={24} />
                        </button>
                        <span className="text-sm font-bold truncate max-w-[150px] ltr">{activeFile || 'No file'}</span>
                        <div className="flex gap-2">
                            {isSaving && <Icon name="RefreshCw" size={16} className="animate-spin text-blue-400" />}
                            <Icon name="Code2" size={24} className="text-blue-500" />
                        </div>
                    </div>

                    {/* Sidebar Overlay (Mobile) */}
                    {isSidebarOpen && window.innerWidth <= 768 && (
                        <div className="fixed inset-0 bg-black/50 z-40" onClick={() => setSidebarOpen(false)} />
                    )}

                    {/* Sidebar */}
                    <aside className={`sidebar-mobile w-72 bg-[#161b22] border-l border-[#30363d] flex flex-col z-50 ${isSidebarOpen ? 'sidebar-open' : ''}`}>
                        <div className="p-4 flex items-center justify-between border-b border-[#30363d]">
                            <h1 className="font-bold text-white flex items-center gap-2">
                                <Icon name="Box" className="text-blue-500" /> ProCode
                            </h1>
                            <button onClick={() => setSidebarOpen(false)} className="md:hidden">
                                <Icon name="X" />
                            </button>
                        </div>

                        <div className="p-4">
                            <div className="relative group">
                                <input 
                                    type="
            const downloadProject = async () => {
                if (!libsReady || !jszipRef.current || selectedFiles.length === 0) return;
                setIsExporting(true);
                try {
                    const zip = new jszipRef.current();
                    selectedFiles.forEach(path => zip.file(path, files[path]));
                    const blob = await zip.generateAsync({ type: 'blob' });
                    window.saveAs(blob, "project.zip");
                } catch (err) {
                    console.error("Export failed", err);
                } finally {
                    setIsExporting(false);
                }
            };

            return (
                <div className="flex h-screen bg-[#0d1117] text-[#c9d1d9] font-sans">
                    {/* Activity Bar */}
                    <div className="w-16 bg-[#161b22] border-l border-[#30363d] flex flex-col items-center py-4 gap-6">
                        <Icon name="Box" size={28} className="text-blue-500 mb-4" />
                        <Icon name="FileCode" size={24} className="text-white cursor-pointer" />
                        <Icon name="Settings" size={24} className="text-[#8b949e] mt-auto cursor-pointer" />
                    </div>

                    {/* Sidebar */}
                    <div className="w-80 bg-[#0d1117] border-l border-[#30363d] flex flex-col">
                        <div className="p-4 flex justify-between items-center text-xs font-bold text-[#8b949e] uppercase">
                            <span>סייר קבצים</span>
                            <div className="flex gap-2">
                                <button onClick={() => setNewPath('file.js')} title="קובץ חדש">
                                    <Icon name="FilePlus" size={16} />
                                </button>
                            </div>
                        </div>

                        <div className="px-4 pb-4">
                            <input 
                                type="text"
                                value={newPath}
                                onChange={(e) => setNewPath(e.target.value)}
                                onKeyDown={(e) => e.key === 'Enter' && handleCreateFile()}
                                placeholder="שם קובץ חדש..."
                                className="w-full bg-[#161b22] border border-[#30363d] rounded px-3 py-1.5 text-xs ltr focus:border-blue-500 outline-none"
                            />
                        </div>

                        <div className="flex-grow overflow-y-auto px-2 space-y-0.5 custom-scrollbar">
                            {Object.keys(files).sort().map(path => (
                                <div 
                                    key={path}
                                    onClick={() => setActiveFile(path)}
                                    className={`group flex items-center justify-between p-2 rounded-md cursor-pointer ${
                                        activeFile === path ? 'bg-[#21262d] text-white' : 'hover:bg-[#161b22] text-[#8b949e]'
                                    }`}
                                >
                                    <div className="flex items-center gap-2 truncate ltr">
                                        <Icon name="FileCode" size={14} className={activeFile === path ? 'text-blue-400' : 'text-[#484f58]'} />
                                        <span className="text-sm truncate">{path}</span>
                                    </div>
                                    <button onClick={(e) => handleDeleteFile(path, e)} className="opacity-0 group-hover:opacity-100 hover:text-red-400">
                                        <Icon name="Trash2" size={14} />
                                    </button>
                                </div>
                            ))}
                        </div>

                        <div className="p-4 bg-[#161b22] border-t border-[#30363d]">
                            <button 
                                onClick={downloadProject}
                                disabled={isExporting}
                                className="w-full bg-[#238636] hover:bg-[#2ea043] text-white text-sm font-semibold py-2 rounded-md flex items-center justify-center gap-2"
                            >
                                {isExporting ? <Icon name="Loader2" size={18} className="animate-spin" /> : <Icon name="Download" size={18} />}
                                הורד הכל (ZIP)
                            </button>
                        </div>
                    </div>

                    {/* Main Content */}
                    <div className="flex-grow flex flex-col bg-[#0d1117]">
                        {activeFile ? (
                            <>
                                <div className="bg-[#161b22] border-b border-[#30363d] px-4 py-2 text-xs flex items-center gap-2 ltr">
                                    <Icon name="FileCode" size={14} className="text-blue-400" />
                                    <span>{activeFile}</span>
                                </div>
                                <textarea
                                    value={files[activeFile]}
                                    onChange={(e) => setFiles({ ...files, [activeFile]: e.target.value })}
                                    className="flex-grow bg-transparent p-4 font-mono text-sm outline-none resize-none ltr text-[#e6edf3] custom-scrollbar"
                                    spellCheck="false"
                                />
                            </>
                        ) : (
                            <div className="flex-grow flex flex-col items-center justify-center opacity-20">
                                <Icon name="Code2" size={100} />
                                <p>בחר קובץ לעריכה</p>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
