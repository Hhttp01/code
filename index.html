<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ProCode IDE+ - Editor Full Professional</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <style>
        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar { width: 10px; height: 10px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #0d1117; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #30363d; border-radius: 6px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #484f58; }
        
        /* Text direction */
        .ltr { direction: ltr; text-align: left; }
        
        /* General */
        body { 
            margin: 0; 
            padding: 0; 
            overflow: hidden; 
            background-color: #0d1117; 
            color: #c9d1d9;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Cascadia Code", "Consolas", monospace;
        }

        /* Sidebar animation */
        @media (max-width: 768px) {
            .sidebar-transition {
                transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }
            .sidebar-hidden { transform: translateX(100%); }
            .sidebar-visible { transform: translateX(0); }
        }

        /* Editor */
        .editor-container {
            line-height: 1.6;
        }

        /* Themes */
        .theme-dark { background-color: #0d1117; color: #c9d1d9; }
        .theme-light { background-color: #ffffff; color: #24292e; }
        .theme-ocean { background-color: #0a1929; color: #89d4ff; }
        
        /* Code highlighting */
        .code-line-number {
            color: #6e7681;
            user-select: none;
            min-width: 40px;
            text-align: right;
            padding-right: 12px;
        }
        
        /* Terminal */
        .terminal {
            background: #161b22;
            font-family: "Cascadia Code", "Consolas", monospace;
            font-size: 13px;
        }
        
        /* Button animations */
        .btn-pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        /* Split panel */
        .split-panel {
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        const STORAGE_KEY = 'procode_ide_enhanced_v2';
        const MAX_FILE_SIZE = 1024 * 1024; // 1MB

        // Language configurations
        const LANGUAGE_CONFIG = {
            '.js': { name: 'JavaScript', mode: 'javascript', runner: 'js' },
            '.jsx': { name: 'React JSX', mode: 'jsx', runner: 'js' },
            '.ts': { name: 'TypeScript', mode: 'typescript', runner: 'ts' },
            '.tsx': { name: 'TypeScript React', mode: 'tsx', runner: 'ts' },
            '.html': { name: 'HTML', mode: 'html', runner: 'html' },
            '.css': { name: 'CSS', mode: 'css', runner: 'css' },
            '.py': { name: 'Python', mode: 'python', runner: 'py' },
            '.json': { name: 'JSON', mode: 'json', runner: 'json' },
            '.md': { name: 'Markdown', mode: 'markdown', runner: 'text' },
            '.java': { name: 'Java', mode: 'java', runner: 'java' },
            '.php': { name: 'PHP', mode: 'php', runner: 'php' },
            '.sql': { name: 'SQL', mode: 'sql', runner: 'text' },
            '.xml': { name: 'XML', mode: 'xml', runner: 'text' }
        };

        // Themes
        const THEMES = [
            { id: 'dark', name: '×›×”×” (×‘×¨×™×¨×ª ××—×“×œ)', bg: '#0d1117', fg: '#c9d1d9' },
            { id: 'light', name: '×‘×”×™×¨', bg: '#ffffff', fg: '#24292e' },
            { id: 'ocean', name: '××•×§×™×™× ×•×¡', bg: '#0a1929', fg: '#89d4ff' },
            { id: 'monokai', name: '××•× ×•×§××™', bg: '#272822', fg: '#f8f8f2' },
            { id: 'solarized', name: '×¡×•×œ××¨×™×™×–×“', bg: '#002b36', fg: '#839496' }
        ];

        // Smart icon component
        const Icon = ({ name, size = 18, className = "", spin = false }) => {
            const iconRef = useRef(null);
            useEffect(() => {
                if (iconRef.current && window.lucide) {
                    const iconData = lucide[name] || lucide.File;
                    iconRef.current.innerHTML = '';
                    const iconEl = lucide.createIconElement(iconData);
                    if (iconEl) {
                        iconRef.current.appendChild(iconEl);
                        iconEl.setAttribute('width', size);
                        iconEl.setAttribute('height', size);
                        iconEl.classList.add('inline-block');
                        if (spin) {
                            iconEl.classList.add('animate-spin');
                        }
                    }
                }
            }, [name, size, spin]);
            return <span ref={iconRef} className={`inline-flex items-center justify-center ${className}`}></span>;
        };

        // Code line number component
        const CodeLineNumbers = ({ content }) => {
            const lines = content.split('\n').length;
            return (
                <div className="absolute left-0 top-0 h-full overflow-hidden select-none">
                    {Array.from({ length: lines }).map((_, i) => (
                        <div key={i} className="code-line-number text-right pr-3 leading-6">
                            {i + 1}
                        </div>
                    ))}
                </div>
            );
        };

        const App = () => {
            // State
            const [files, setFiles] = useState(() => {
                const saved = localStorage.getItem(STORAGE_KEY);
                return saved ? JSON.parse(saved) : {
                    'welcome.js': '// ×‘×¨×•×›×™× ×”×‘××™× ×œ-ProCode IDE+!\nconsole.log("×©×œ×•× ×¢×•×œ×!");\n\n// × ×¡×” ×œ×”×¨×™×¥ ××ª ×”×§×•×“ ×¢× Ctrl+Enter\n\nfunction factorial(n) {\n    if (n <= 1) return 1;\n    return n * factorial(n - 1);\n}\n\nconsole.log("×¢×•×‘×“×” ×©×œ 5:", factorial(5));',
                    'styles.css': '/* ×¢×™×¦×•×‘ ×‘×¡×™×¡×™ */\nbody {\n    margin: 0;\n    padding: 0;\n    font-family: system-ui, -apple-system, sans-serif;\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    min-height: 100vh;\n}\n\n.container {\n    max-width: 1200px;\n    margin: 0 auto;\n    padding: 2rem;\n}\n\nh1 {\n    color: white;\n    text-shadow: 0 2px 4px rgba(0,0,0,0.2);\n}',
                    'index.html': '<!DOCTYPE html>\n<html lang="he">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>×¤×¨×•×™×§×˜ ×©×œ×™</title>\n    <link rel="stylesheet" href="styles.css">\n</head>\n<body>\n    <div class="container">\n        <h1>×©×œ×•× ProCode!</h1>\n        <p id="message">×˜×¢×™× ×”...</p>\n        <button onclick="showAlert()">×œ×—×¥ ×›××Ÿ</button>\n    </div>\n    <script src="welcome.js"></script>\n    <script>\n        function showAlert() {\n            alert("×”×›×¤×ª×•×¨ ×¢×•×‘×“!");\n            document.getElementById("message").textContent = "×”×›×¤×ª×•×¨ × ×œ×—×¥ ×‘×”×¦×œ×—×”!";\n        }\n    </script>\n</body>\n</html>',
                    'readme.md': '# ğŸ“ ProCode IDE+\n\n## ×¤×¨×•×™×§×˜ ×œ×“×•×’××”\n\n### ×ª×›×•× ×•×ª:\n1. âœ¨ ×¢×•×¨×š ×§×•×“ ××ª×§×“×\n2. ğŸš€ ×”×¨×¦×ª ×§×•×“ ×™×©×™×¨×•×ª ×‘×“×¤×“×¤×Ÿ\n3. ğŸ’¾ ×©××™×¨×” ××•×˜×•××˜×™×ª\n4. ğŸ“¦ ×™×™×¦×•× ZIP\n5. ğŸ¨ × ×•×©××™× ××•×ª×××™× ××™×©×™×ª\n\n### ×§×™×¦×•×¨×™ ××§×©×™×:\n- **Ctrl+S**: ×©××™×¨×”\n- **Ctrl+Enter**: ×”×¨×¦×ª ×§×•×“\n- **Ctrl+F**: ×—×™×¤×•×©\n- **Ctrl+Z**: ×‘×™×˜×•×œ\n- **Ctrl+Shift+P**: ×¤×§×•×“×•×ª\n'
                };
            });
            
            const [activeFile, setActiveFile] = useState(Object.keys(files)[0] || '');
            const [newFileName, setNewFileName] = useState('');
            const [isSidebarOpen, setSidebarOpen] = useState(window.innerWidth > 768);
            const [isSaving, setIsSaving] = useState(false);
            const [isExporting, setIsExporting] = useState(false);
            const [output, setOutput] = useState('');
            const [isRunning, setIsRunning] = useState(false);
            const [searchTerm, setSearchTerm] = useState('');
            const [theme, setTheme] = useState('dark');
            const [showPreview, setShowPreview] = useState(false);
            const [showTerminal, setShowTerminal] = useState(false);
            const [fontSize, setFontSize] = useState(14);
            const [showCommands, setShowCommands] = useState(false);
            const [showSettings, setShowSettings] = useState(false);
            const [splitView, setSplitView] = useState(false);
            
            const editorRef = useRef(null);
            const jszipRef = useRef(null);
            const previewRef = useRef(null);

            // Effects
            useEffect(() => {
                setIsSaving(true);
                const timeout = setTimeout(() => {
                    const saveData = {
                        files,
                        theme,
                        fontSize,
                        activeFile
                    };
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(saveData));
                    setIsSaving(false);
                }, 800);
                return () => clearTimeout(timeout);
            }, [files, theme, fontSize, activeFile]);

            useEffect(() => {
                const loadDependencies = async () => {
                    const libs = [
                        'https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js',
                        'https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js'
                    ];
                    for (const src of libs) {
                        if (!document.querySelector(`script[src="${src}"]`)) {
                            const s = document.createElement('script');
                            s.src = src;
                            s.async = true;
                            document.body.appendChild(s);
                            await new Promise(r => s.onload = r);
                        }
                    }
                    jszipRef.current = window.JSZip;
                };
                loadDependencies();
                
                const handleResize = () => {
                    if (window.innerWidth > 768) setSidebarOpen(true);
                };
                
                window.addEventListener('resize', handleResize);
                
                // Keyboard shortcuts
                const handleKeyDown = (e) => {
                    if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                        e.preventDefault();
                        setIsSaving(true);
                        setTimeout(() => setIsSaving(false), 500);
                    }
                    if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                        e.preventDefault();
                        handleRunCode();
                    }
                    if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
                        e.preventDefault();
                        document.querySelector('input[placeholder*="×—×™×¤×•×©"]')?.focus();
                    }
                    if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'P') {
                        e.preventDefault();
                        setShowCommands(true);
                    }
                    if (e.key === 'Escape') {
                        setShowCommands(false);
                        setShowSettings(false);
                    }
                };
                
                window.addEventListener('keydown', handleKeyDown);
                return () => {
                    window.removeEventListener('resize', handleResize);
                    window.removeEventListener('keydown', handleKeyDown);
                };
            }, []);

            // Functions
            const getFileLanguage = (filename) => {
                const ext = filename.includes('.') 
                    ? filename.substring(filename.lastIndexOf('.'))
                    : '';
                return LANGUAGE_CONFIG[ext] || { name: 'Text', mode: 'text', runner: 'text' };
            };

            const handleCreateFile = () => {
                if (!newFileName.trim()) return;
                let name = newFileName.trim();
                if (!name.includes('.')) name += '.js';
                
                if (files[name]) {
                    alert('×§×•×‘×¥ ×‘×©× ×–×” ×›×‘×¨ ×§×™×™×');
                    return;
                }
                
                if (name.length > 100) {
                    alert('×©× ×”×§×•×‘×¥ ××¨×•×š ××“×™');
                    return;
                }
                
                const template = getDefaultTemplate(name);
                setFiles(prev => ({ ...prev, [name]: template }));
                setActiveFile(name);
                setNewFileName('');
                if (window.innerWidth <= 768) setSidebarOpen(false);
            };

            const getDefaultTemplate = (filename) => {
                if (filename.endsWith('.html')) {
                    return `<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×“×£ ×—×“×©</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>×©×œ×•× ×¢×•×œ×!</h1>
    <script src="script.js"></script>
</body>
</html>`;
                } else if (filename.endsWith('.css')) {
                    return `/* ×¡×’× ×•× ×•×ª ×—×“×©×™× */
body {
    margin: 0;
    padding: 0;
    font-family: system-ui, sans-serif;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
}`;
                } else if (filename.endsWith('.py')) {
                    return `# ×¤×™×™×ª×•×Ÿ ×—×“×©
print("×©×œ×•× ×¢×•×œ×!")

def greet(name):
    return f"×©×œ×•× {name}!"

print(greet("××©×ª××©"))`;
                }
                return `// ×§×•×‘×¥ ×—×“×©: ${filename}
console.log("×§×•×‘×¥ × ×•×¦×¨ ×‘×”×¦×œ×—×”!");`;
            };

            const handleDeleteFile = (path, e) => {
                e.stopPropagation();
                if (Object.keys(files).length <= 1) {
                    alert('×œ× × ×™×ª×Ÿ ×œ××—×•×§ ××ª ×”×§×•×‘×¥ ×”××—×¨×•×Ÿ');
                    return;
                }
                if (confirm(`×œ××—×•×§ ××ª "${path}"?`)) {
                    const updatedFiles = { ...files };
                    delete updatedFiles[path];
                    setFiles(updatedFiles);
                    if (activeFile === path) {
                        setActiveFile(Object.keys(updatedFiles)[0] || '');
                    }
                }
            };

            const handleRunCode = async () => {
                if (!activeFile) return;
                
                setIsRunning(true);
                setOutput('ğŸš€ ××¨×™×¥ ×§×•×“...\n');
                setShowTerminal(true);
                
                try {
                    const language = getFileLanguage(activeFile).runner;
                    const code = files[activeFile];
                    
                    setTimeout(() => {
                        let result = '';
                        
                        switch (language) {
                            case 'html':
                                // For HTML, set preview iframe
                                setShowPreview(true);
                                result = 'ğŸ“„ ×“×£ HTML ××•×›×Ÿ ×œ×ª×¦×•×’×” ××§×“×™××”';
                                break;
                                
                            case 'css':
                                result = 'ğŸ¨ ×¡×’× ×•× ×•×ª CSS ×”×•×¢××¡×•';
                                setShowPreview(true);
                                break;
                                
                            case 'js':
                                try {
                                    // Create sandbox for JS execution
                                    const iframe = document.createElement('iframe');
                                    iframe.style.display = 'none';
                                    document.body.appendChild(iframe);
                                    
                                    const consoleLog = [];
                                    const originalLog = iframe.contentWindow.console.log;
                                    iframe.contentWindow.console.log = (...args) => {
                                        consoleLog.push(args.join(' '));
                                    };
                                    
                                    const script = iframe.contentWindow.document.createElement('script');
                                    script.textContent = `
                                        try {
                                            ${code}
                                        } catch(e) {
                                            console.log('âŒ ×©×’×™××”:', e.message);
                                        }
                                    `;
                                    iframe.contentWindow.document.body.appendChild(script);
                                    
                                    result = consoleLog.join('\n') || 'âœ… ×§×•×“ ×”×•×¨×¥ ×œ×œ× ×”×•×“×¢×•×ª';
                                    document.body.removeChild(iframe);
                                } catch (err) {
                                    result = `âŒ ×©×’×™××”: ${err.message}`;
                                }
                                break;
                                
                            case 'py':
                                // Simulated Python execution
                                result = 'ğŸ Python (×¡×™××•×œ×¦×™×”) - ×”×©×ª××© ×‘-Pyodide ×œ×”×¨×¦×” ×××™×ª×™×ª';
                                break;
                                
                            default:
                                result = `âœ… ${getFileLanguage(activeFile).name} - ××™×Ÿ ×”×¨×¦×” ×™×©×™×¨×” ×–××™× ×”`;
                        }
                        
                        setOutput(prev => prev + result + '\n\n--- ×¡×™×•× ×”×¨×¦×” ---');
                        setIsRunning(false);
                    }, 1000);
                    
                } catch (error) {
                    setOutput(prev => prev + `âŒ ×©×’×™××”: ${error.message}`);
                    setIsRunning(false);
                }
            };

            const handleDownloadProject = async () => {
                if (!jszipRef.current) {
                    alert('×˜×•×¢×Ÿ ×¡×¤×¨×™×•×ª... × ×¡×” ×©×•×‘ ×‘×¢×•×“ ×¨×’×¢');
                    return;
                }
                
                setIsExporting(true);
                try {
                    const zip = new jszipRef.current();
                    
                    // Add files
                    Object.entries(files).forEach(([name, content]) => {
                        zip.file(name, content);
                    });
                    
                    // Add project info
                    const projectInfo = {
                        name: "ProCode Project",
                        created: new Date().toISOString(),
                        files: Object.keys(files),
                        settings: { theme, fontSize }
                    };
                    zip.file("project-info.json", JSON.stringify(projectInfo, null, 2));
                    
                    const blob = await zip.generateAsync({ type: 'blob' });
                    window.saveAs(blob, `procode-project-${Date.now()}.zip`);
                } catch (err) {
                    console.error("Export failed", err);
                    alert('×©×’×™××” ×‘×™×™×¦×•× ×”×¤×¨×•×™×§×˜');
                } finally {
                    setIsExporting(false);
                }
            };

            const handleImportFiles = (e) => {
                const fileList = e.target.files;
                if (!fileList.length) return;
                
                const newFiles = {};
                Array.from(fileList).forEach(file => {
                    if (file.size > MAX_FILE_SIZE) {
                        alert(`×”×§×•×‘×¥ ${file.name} ×’×“×•×œ ××“×™ (××§×¡×™××•× 1MB)`);
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        newFiles[file.name] = e.target.result;
                        if (Object.keys(newFiles).length === fileList.length) {
                            setFiles(prev => ({ ...prev, ...newFiles }));
                        }
                    };
                    reader.readAsText(file);
                });
                
                e.target.value = ''; // Reset input
            };

            const handleClearOutput = () => {
                setOutput('');
            };

            const handleSearch = () => {
                if (!searchTerm.trim() || !activeFile) return;
                
                const content = files[activeFile];
                const regex = new RegExp(searchTerm, 'gi');
                const matches = (content.match(regex) || []).length;
                
                if (matches === 0) {
                    setOutput('ğŸ” ×œ× × ××¦××• ×”×ª×××•×ª');
                } else {
                    setOutput(`ğŸ” × ××¦××• ${matches} ×”×ª×××•×ª`);
                    // Highlight would go here in a more advanced implementation
                }
            };

            const updatePreview = () => {
                if (!previewRef.current || !files['index.html']) return;
                
                let htmlContent = files['index.html'] || '';
                const cssContent = files['styles.css'] || '';
                
                // Inject CSS
                htmlContent = htmlContent.replace('</head>', 
                    `<style>${cssContent}</style>\n</head>`);
                
                // Update iframe
                previewRef.current.srcdoc = htmlContent;
            };

            useEffect(() => {
                if (showPreview && activeFile.endsWith('.html')) {
                    updatePreview();
                }
            }, [files, showPreview, activeFile]);

            return (
                <div className={`h-screen w-screen overflow-hidden theme-${theme}`}>
                    {/* Command Palette */}
                    {showCommands && (
                        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4">
                            <div className="bg-[#161b22] rounded-lg w-full max-w-lg border border-[#30363d] shadow-2xl">
                                <div className="p-4 border-b border-[#30363d] flex justify-between items-center">
                                    <span className="text-sm font-bold">×¤×§×•×“×•×ª (Ctrl+Shift+P)</span>
                                    <button onClick={() => setShowCommands(false)} className="text-gray-400 hover:text-white">
                                        <Icon name="X" size={18} />
                                    </button>
                                </div>
                                <div className="p-2">
                                    {[
                                        { icon: 'Play', label: '×”×¨×¥ ×§×•×“', shortcut: 'Ctrl+Enter', action: handleRunCode },
                                        { icon: 'Download', label: '×™×™×¦× ×¤×¨×•×™×§×˜', shortcut: '', action: handleDownloadProject },
                                        { icon: 'Save', label: '×©××•×¨', shortcut: 'Ctrl+S', action: () => setIsSaving(true) },
                                        { icon: 'Eye', label: '×”×¦×’ ×ª×¦×•×’×” ××§×“×™××”', shortcut: '', action: () => setShowPreview(!showPreview) },
                                        { icon: 'Terminal', label: '×”×¦×’ ×˜×¨××™× ×œ', shortcut: '', action: () => setShowTerminal(!showTerminal) },
                                        { icon: 'Split', label: '××¡×š ××¤×•×¦×œ', shortcut: '', action: () => setSplitView(!splitView) },
                                        { icon: 'Settings', label: '×”×’×“×¨×•×ª', shortcut: '', action: () => setShowSettings(true) },
                                    ].map((cmd, i) => (
                                        <div key={i} 
                                            onClick={() => { cmd.action(); setShowCommands(false); }}
                                            className="flex items-center justify-between p-3 hover:bg-[#21262d] rounded cursor-pointer"
                                        >
                                            <div className="flex items-center gap-3">
                                                <Icon name={cmd.icon} size={16} />
                                                <span>{cmd.label}</span>
                                            </div>
                                            {cmd.shortcut && <span className="text-xs text-gray-400">{cmd.shortcut}</span>}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Settings Modal */}
                    {showSettings && (
                        <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4">
                            <div className="bg-[#161b22] rounded-lg w-full max-w-2xl border border-[#30363d] shadow-2xl max-h-[90vh] overflow-y-auto">
                                <div className="p-4 border-b border-[#30363d] flex justify-between items-center">
                                    <span className="text-lg font-bold">×”×’×“×¨×•×ª</span>
                                    <button onClick={() => setShowSettings(false)} className="text-gray-400 hover:text-white">
                                        <Icon name="X" size={20} />
                                    </button>
                                </div>
                                <div className="p-6 space-y-6">
                                    <div>
                                        <label className="block text-sm font-medium mb-2">×¢×¨×›×ª × ×•×©×</label>
                                        <div className="grid grid-cols-2 md:grid-cols-5 gap-2">
                                            {THEMES.map(t => (
                                                <button key={t.id}
                                                    onClick={() => setTheme(t.id)}
                                                    className={`p-3 rounded border ${theme === t.id ? 'border-blue-500 ring-2 ring-blue-500/30' : 'border-[#30363d]'}`}
                                                    style={{ backgroundColor: t.bg, color: t.fg }}
                                                >
                                                    {t.name}
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label className="block text-sm font-medium mb-2">×’×•×“×œ ×¤×•× ×˜: {fontSize}px</label>
                                        <input type="range" min="10" max="24" value={fontSize}
                                            onChange={(e) => setFontSize(parseInt(e.target.value))}
                                            className="w-full h-2 bg-[#30363d] rounded-lg appearance-none cursor-pointer"
                                        />
                                    </div>
                                    
                                    <div>
                                        <label className="block text-sm font-medium mb-2">×™×™×‘×•× ×§×‘×¦×™×</label>
                                        <label className="flex items-center justify-center p-4 border-2 border-dashed border-[#30363d] rounded-lg cursor-pointer hover:border-blue-500">
                                            <Icon name="Upload" size={24} className="mr-2" />
                                            <span>×’×¨×•×¨ ×§×‘×¦×™× ×œ×›××Ÿ ××• ×œ×—×¥ ×œ×‘×—×™×¨×”</span>
                                            <input type="file" multiple className="hidden" 
                                                onChange={handleImportFiles}
                                                accept=".js,.jsx,.ts,.tsx,.html,.css,.json,.md,.py,.java,.php"
                                            />
                                        </label>
                                    </div>
                                    
                                    <div className="flex gap-3 pt-4 border-t border-[#30363d]">
                                        <button onClick={() => localStorage.clear() && window.location.reload()}
                                            className="px-4 py-2 bg-red-500/20 text-red-400 rounded hover:bg-red-500/30">
                                            × ×§×” ×›×œ ×”×©××•×¨×•×ª
                                        </button>
                                        <button onClick={() => setShowSettings(false)}
                                            className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 flex-1">
                                            ×¡×’×•×¨
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Main Layout */}
                    <div className="flex h-full">
                        {/* Activity Bar */}
                        <div className="hidden md:flex w-16 bg-[#161b22] border-l border-[#30363d] flex-col items-center py-6 gap-8">
                            <Icon name="Code2" size={28} className="text-blue-500" />
                            <button onClick={() => setSidebarOpen(!isSidebarOpen)} 
                                className={`p-2 rounded ${isSidebarOpen ? 'bg-blue-500/20 text-blue-400' : 'text-gray-400 hover:text-white'}`}>
                                <Icon name="Files" size={24} />
                            </button>
                            <button onClick={handleRunCode}
                                className="p-2 text-green-400 hover:text-green-300">
                                <Icon name="Play" size={24} />
                            </button>
                            <button onClick={() => setShowTerminal(!showTerminal)}
                                className={`p-2 ${showTerminal ? 'text-yellow-400' : 'text-gray-400 hover:text-white'}`}>
                                <Icon name="Terminal" size={24} />
                            </button>
                            <button onClick={() => setShowPreview(!showPreview)}
                                className={`p-2 ${showPreview ? 'text-purple-400' : 'text-gray-400 hover:text-white'}`}>
                                <Icon name="Eye" size={24} />
                            </button>
                            <button onClick={() => setShowSettings(true)}
                                className="p-2 text-gray-400 mt-auto hover:text-white">
                                <Icon name="Settings" size={24} />
                            </button>
                        </div>

                        {/* Sidebar */}
                        <aside className={`
                            fixed md:relative md:translate-x-0
                            sidebar-transition z-40
                            w-80 h-full bg-[#0d1117] border-l border-[#30363d]
                            flex flex-col shadow-2xl
                            ${isSidebarOpen ? 'sidebar-visible right-0' : 'sidebar-hidden -right-80 md:right-0'}
                        `}>
                            <div className="p-4 flex items-center justify-between border-b border-[#30363d]">
                                <span className="text-sm font-bold uppercase tracking-wider">×¡×™×™×¨ ×§×‘×¦×™×</span>
                                <div className="flex items-center gap-2">
                                    <button onClick={() => setShowCommands(true)} className="p-1.5 text-gray-400 hover:text-white">
                                        <Icon name="Command" size={16} />
                                    </button>
                                    <button onClick={() => setSidebarOpen(false)} className="p-1.5 md:hidden">
                                        <Icon name="X" size={18} />
                                    </button>
                                </div>
                            </div>

                            {/* Search */}
                            <div className="p-4">
                                <div className="relative">
                                    <input 
                                        type="text"
                                        value={searchTerm}
                                        onChange={(e) => setSearchTerm(e.target.value)}
                                        onKeyDown={(e) => e.key === 'Enter' && handleSearch()}
                                        placeholder="×—×™×¤×•×© ×‘×§×•×‘×¥..."
                                        className="w-full bg-[#161b22] border border-[#30363d] rounded py-2 px-10 text-sm ltr focus:border-blue-500 outline-none"
                                    />
                                    <Icon name="Search" size={16} className="absolute left-3 top-2.5 text-gray-500" />
                                    {searchTerm && (
                                        <button onClick={() => setSearchTerm('')}
                                            className="absolute left-8 top-2.5 text-gray-500 hover:text-white">
                                            <Icon name="X" size={14} />
                                        </button>
                                    )}
                                </div>
                            </div>

                            {/* New File Input */}
                            <div className="px-4 mb-4">
                                <div className="relative group">
                                    <input 
                                        type="text"
                                        value={newFileName}
                                        onChange={(e) => setNewFileName(e.target.value)}
                                        onKeyDown={(e) => e.key === 'Enter' && handleCreateFile()}
                                        placeholder="×§×•×‘×¥ ×—×“×© (×œ×“×•×’××”: script.js)"
                                        className="w-full bg-[#161b22] border border-[#30363d] rounded py-2.5 px-4 text-sm ltr focus:border-blue-500 outline-none"
                                    />
                                    <button onClick={handleCreateFile} 
                                        className="absolute left-2.5 top-2 text-gray-500 hover:text-blue-400">
                                        <Icon name="Plus" size={18} />
                                    </button>
                                </div>
                            </div>

                            {/* File List */}
                            <div className="flex-grow overflow-y-auto px-2 space-y-1 custom-scrollbar">
                                {Object.keys(files).sort().map(path => {
                                    const lang = getFileLanguage(path);
                                    return (
                                        <div 
                                            key={path}
                                            onClick={() => {
                                                setActiveFile(path);
                                                if (window.innerWidth <= 768) setSidebarOpen(false);
                                            }}
                                            className={`
                                                group flex items-center justify-between p-3 rounded-lg cursor-pointer transition-all
                                                ${activeFile === path ? 'bg-[#21262d] text-white shadow-md' : 'hover:bg-[#161b22] text-[#8b949e]'}
                                            `}
                                        >
                                            <div className="flex items-center gap-3 truncate ltr">
                                                <Icon 
                                                    name={lang.icon || "FileCode"} 
                                                    size={16} 
                                                    className={activeFile === path ? 'text-blue-400' : 'text-[#484f58]'} 
                                                />
                                                <div className="truncate">
                                                    <div className="text-sm font-medium truncate">{path}</div>
                                                    <div className="text-xs text-gray-500">{lang.name}</div>
                                                </div>
                                            </div>
                                            <div className="flex items-center gap-1">
                                                <span className="text-xs text-gray-500">
                                                    {files[path].split('\n').length} ×©×•×¨×•×ª
                                                </span>
                                                <button 
                                                    onClick={(e) => handleDeleteFile(path, e)}
                                                    className="opacity-0 group-hover:opacity-100 hover:text-red-400 p-1"
                                                >
                                                    <Icon name="Trash2" size={14} />
                                                </button>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>

                            {/* Sidebar Footer */}
                            <div className="p-4 bg-[#161b22] border-t border-[#30363d] space-y-3">
                                <button 
                                    onClick={handleDownloadProject}
                                    disabled={isExporting}
                                    className="w-full bg-[#238636] hover:bg-[#2ea043] disabled:opacity-50 text-white text-sm font-bold py-3 rounded-md flex items-center justify-center gap-2 transition-colors"
                                >
                                    {isExporting ? <Icon name="Loader2" size={18} spin /> : <Icon name="Download" size={18} />}
                                    ×™×™×¦×•× ×¤×¨×•×™×§×˜ (ZIP)
                                </button>
                                <div className="text-xs text-center text-gray-500">
                                    {Object.keys(files).length} ×§×‘×¦×™×, {Object.values(files).reduce((acc, cur) => acc + cur.length, 0)} ×ª×•×•×™×
                                </div>
                            </div>
                        </aside>

                        {/* Main Content */}
                        <main className="flex-grow flex flex-col min-w-0 relative">
                            {/* Mobile Header */}
                            <div className="md:hidden flex h-14 bg-[#161b22] border-b border-[#30363d] items-center justify-between px-4">
                                <button onClick={() => setSidebarOpen(true)} className="p-2 text-white">
                                    <Icon name="Menu" size={24} />
                                </button>
                                <span className="text-sm font-mono truncate px-4 ltr">
                                    {activeFile || 'No file selected'}
                                </span>
                                <button onClick={handleRunCode} className="p-2 text-green-400">
                                    <Icon name="Play" size={20} />
                                </button>
                            </div>

                            {/* Desktop Header */}
                            <div className="hidden md:flex bg-[#161b22] border-b border-[#30363d] px-4 py-3 items-center justify-between">
                                <div className="flex items-center gap-3 text-sm ltr overflow-hidden">
                                    <Icon name={getFileLanguage(activeFile).icon || "FileCode"} size={16} className="text-blue-400" />
                                    <span className="text-gray-500">src/</span>
                                    <span className="text-white font-medium truncate">{activeFile}</span>
                                    <span className="text-xs text-gray-500 px-2