<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ProCode IDE - סביבת פיתוח מלאה</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <style>
        /* עיצוב גלילה */
        .custom-scrollbar::-webkit-scrollbar { width: 8px; height: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #0d1117; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #30363d; border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #484f58; }
        
        /* כיווניות טקסט לקוד */
        .ltr { direction: ltr; text-align: left; }
        
        body { 
            margin: 0; 
            padding: 0; 
            overflow: hidden; 
            background-color: #0d1117; 
            color: #c9d1d9;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
        }

        /* אנימציה לסרגל צד במובייל */
        @media (max-width: 768px) {
            .sidebar-transition {
                transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }
            .sidebar-hidden { transform: translateX(100%); }
            .sidebar-visible { transform: translateX(0); }
        }

        /* אנימציות */
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .animate-slideUp { animation: slideUp 0.3s ease-out; }
        .animate-pulse { animation: pulse 2s infinite; }
        
        /* עיצוב עבור Prism */
        pre[class*="language-"] {
            margin: 0;
            background: transparent !important;
            min-height: 100%;
            padding: 1rem !important;
        }
        
        code[class*="language-"] {
            font-family: 'Consolas', 'Monaco', 'Andale Mono', 'Ubuntu Mono', monospace !important;
            font-size: 14px;
            line-height: 1.6;
        }
        
        /* עורך קוד עם היילאיטינג */
        .code-editor {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            font-family: 'Consolas', 'Monaco', 'Andale Mono', monospace;
            font-size: 14px;
            line-height: 1.6;
            tab-size: 4;
            white-space: pre !important;
            overflow: auto;
            padding: 1rem;
            background: transparent;
            color: transparent;
            caret-color: #58a6ff;
            resize: none;
            outline: none;
            border: none;
        }
        
        .code-highlight {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            overflow: auto;
            padding: 1rem;
        }
        
        .editor-container {
            position: relative;
            min-height: 100%;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        const STORAGE_KEY = 'pro_code_ide_storage_v2';

        // רכיב אייקונים חכם של Lucide
        const Icon = ({ name, size = 18, className = "", ...props }) => {
            const iconRef = useRef(null);
            useEffect(() => {
                if (iconRef.current && window.lucide) {
                    const iconData = lucide[name] || lucide.File;
                    iconRef.current.innerHTML = '';
                    const svg = lucide.createIconsNode({ name, ...iconData });
                    if (svg) {
                        iconRef.current.appendChild(svg);
                    }
                }
            }, [name]);
            return <i ref={iconRef} className={`inline-flex items-center justify-center ${className}`} style={{ width: size, height: size }} {...props}></i>;
        };

        const App = () => {
            // --- State ---
            const [files, setFiles] = useState(() => {
                const saved = localStorage.getItem(STORAGE_KEY);
                if (saved) {
                    try {
                        const parsed = JSON.parse(saved);
                        if (Object.keys(parsed).length > 0) return parsed;
                    } catch (e) {}
                }
                
                const date = new Date().toLocaleDateString('he-IL');
                return {
                    'index.html': `<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>פרויקט חדש - ${date}</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>שלום עולם!</h1>
    <p>ברוכים הבאים ל-ProCode IDE</p>
    <script src="script.js"></script>
</body>
</html>`,
                    'style.css': `/* סגנונות לפרויקט - ${date} */
body {
    margin: 0;
    padding: 20px;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f5f5f5;
    color: #333;
    line-height: 1.6;
}

h1 {
    color: #0066cc;
    border-bottom: 2px solid #0066cc;
    padding-bottom: 10px;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}`,
                    'script.js': `// קוד JavaScript - ${date}
console.log('פרויקט ProCode מתחיל...');

function welcome(name) {
    return \`שלום, \${name}!\`;
}

// דוגמה לפונקציה
document.addEventListener('DOMContentLoaded', () => {
    const message = welcome('משתמש יקר');
    console.log(message);
    
    // דוגמה ללוגיקה פשוטה
    const numbers = [1, 2, 3, 4, 5];
    const sum = numbers.reduce((a, b) => a + b, 0);
    console.log(\`סכום המספרים: \${sum}\`);
});`
                };
            });

            const [activeFile, setActiveFile] = useState(Object.keys(files)[0] || '');
            const [newFileName, setNewFileName] = useState('');
            const [isSidebarOpen, setSidebarOpen] = useState(window.innerWidth > 768);
            const [isSaving, setIsSaving] = useState(false);
            const [isExporting, setIsExporting] = useState(false);
            const [searchOpen, setSearchOpen] = useState(false);
            const [searchTerm, setSearchTerm] = useState('');
            const [replaceTerm, setReplaceTerm] = useState('');
            const [notification, setNotification] = useState(null);
            const [splitView, setSplitView] = useState(false);
            const [secondaryFile, setSecondaryFile] = useState('');
            
            const jszipRef = useRef(null);
            const editorRef = useRef(null);
            const highlightRef = useRef(null);
            const fileInputRef = useRef(null);

            // --- Effects ---
            
            // שמירה אוטומטית ל-LocalStorage
            useEffect(() => {
                setIsSaving(true);
                const timeout = setTimeout(() => {
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(files));
                    setIsSaving(false);
                    
                    // הצג הודעת שמירה
                    if (activeFile) {
                        showNotification('נשמר בהצלחה', `הקובץ ${activeFile} נשמר`, 'success');
                    }
                }, 800);
                return () => clearTimeout(timeout);
            }, [files]);

            // טעינת ספריות
            useEffect(() => {
                const loadDependencies = async () => {
                    // טען JSZip ו-FileSaver
                    const libs = [
                        'https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js',
                        'https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js'
                    ];
                    
                    for (const src of libs) {
                        if (!document.querySelector(`script[src="${src}"]`)) {
                            await new Promise((resolve) => {
                                const s = document.createElement('script');
                                s.src = src;
                                s.onload = resolve;
                                document.body.appendChild(s);
                            });
                        }
                    }
                    
                    jszipRef.current = window.JSZip;
                    
                    // טען Prism להיילאיטינג
                    if (!window.Prism) {
                        await Promise.all([
                            new Promise(resolve => {
                                const s = document.createElement('script');
                                s.src = 'https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js';
                                s.onload = resolve;
                                document.body.appendChild(s);
                            }),
                            new Promise(resolve => {
                                const s = document.createElement('script');
                                s.src = 'https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js';
                                s.onload = resolve;
                                document.body.appendChild(s);
                            })
                        ]);
                    }
                };
                
                loadDependencies().catch(console.error);

                const handleResize = () => {
                    if (window.innerWidth > 768) setSidebarOpen(true);
                };
                
                window.addEventListener('resize', handleResize);
                return () => window.removeEventListener('resize', handleResize);
            }, []);

            // קיצורי מקלדת
            useEffect(() => {
                const handleKeyDown = (e) => {
                    if ((e.ctrlKey || e.metaKey) && !e.shiftKey) {
                        switch(e.key) {
                            case 's':
                                e.preventDefault();
                                setIsSaving(true);
                                setTimeout(() => setIsSaving(false), 500);
                                showNotification('נשמר', 'כל הקבצים נשמרו בהצלחה', 'success');
                                break;
                            case 'f':
                                e.preventDefault();
                                setSearchOpen(true);
                                break;
                            case 'b':
                                e.preventDefault();
                                setSidebarOpen(prev => !prev);
                                break;
                            case 'e':
                                e.preventDefault();
                                handleDownloadProject();
                                break;
                        }
                    }
                };

                document.addEventListener('keydown', handleKeyDown);
                return () => document.removeEventListener('keydown', handleKeyDown);
            }, []);

            // היילאיטינג קוד
            useEffect(() => {
                if (editorRef.current && highlightRef.current && window.Prism) {
                    const code = files[activeFile] || '';
                    const language = getLanguage(activeFile);
                    
                    // עדכן את ה-textarea
                    editorRef.current.value = code;
                    
                    // צור קוד עם היילאיטינג
                    highlightRef.current.innerHTML = Prism.highlight(
                        code,
                        Prism.languages[language] || Prism.languages.plaintext,
                        language
                    );
                }
            }, [activeFile, files[activeFile]]);

            // --- Helper Functions ---

            const getLanguage = (filename) => {
                const ext = filename.split('.').pop().toLowerCase();
                const map = {
                    'js': 'javascript',
                    'jsx': 'jsx',
                    'ts': 'typescript',
                    'html': 'html',
                    'css': 'css',
                    'scss': 'scss',
                    'json': 'json',
                    'md': 'markdown',
                    'py': 'python',
                    'php': 'php',
                    'java': 'java',
                    'cpp': 'cpp',
                    'c': 'c',
                    'cs': 'csharp',
                    'go': 'go',
                    'rb': 'ruby',
                    'rs': 'rust',
                    'sql': 'sql',
                    'xml': 'xml',
                    'yaml': 'yaml',
                    'yml': 'yaml',
                    'sh': 'bash'
                };
                return map[ext] || 'plaintext';
            };

            const showNotification = (title, message, type = 'info') => {
                setNotification({ title, message, type });
                setTimeout(() => setNotification(null), 3000);
            };

            const handleCreateFile = () => {
                if (!newFileName.trim()) {
                    showNotification('שגיאה', 'יש להזין שם קובץ', 'error');
                    return;
                }
                
                let name = newFileName.trim();
                if (!name.includes('.')) {
                    name += '.txt';
                }
                
                if (files[name]) {
                    showNotification('שגיאה', 'קובץ בשם זה כבר קיים', 'error');
                    return;
                }
                
                setFiles(prev => ({ ...prev, [name]: '' }));
                setActiveFile(name);
                setNewFileName('');
                
                if (window.innerWidth <= 768) setSidebarOpen(false);
                
                showNotification('קובץ נוצר', `${name} נוצר בהצלחה`, 'success');
            };

            const handleDeleteFile = (path, e) => {
                e.stopPropagation();
                
                if (Object.keys(files).length <= 1) {
                    showNotification('שגיאה', 'לא ניתן למחוק את הקובץ האחרון', 'error');
                    return;
                }
                
                if (confirm(`האם אתה בטוח שברצונך למחוק את "${path}"?`)) {
                    const updatedFiles = { ...files };
                    delete updatedFiles[path];
                    setFiles(updatedFiles);
                    
                    if (activeFile === path || secondaryFile === path) {
                        const remainingFiles = Object.keys(updatedFiles);
                        setActiveFile(remainingFiles[0] || '');
                        if (secondaryFile === path) {
                            setSecondaryFile('');
                        }
                    }
                    
                    showNotification('קובץ נמחק', `${path} נמחק בהצלחה`, 'success');
                }
            };

            const handleDownloadProject = async () => {
                if (!jszipRef.current) {
                    showNotification('שגיאה', 'ספריות הטעינה עדיין לא מוכנות, נסה שוב בעוד רגע', 'error');
                    return;
                }
                
                setIsExporting(true);
                try {
                    const zip = new jszipRef.current();
                    Object.entries(files).forEach(([name, content]) => {
                        zip.file(name, content);
                    });
                    
                    // הוסף קובץ README
                    zip.file('README.md', `# ProCode Project\n\nנוצר ב-${new Date().toLocaleDateString('he-IL')}\n\nפרויקט זה נוצר באמצעות ProCode IDE`);
                    
                    const blob = await zip.generateAsync({ type: 'blob' });
                    window.saveAs(blob, `procode-project-${Date.now()}.zip`);
                    
                    showNotification('הורדה', 'הפרויקט ירד בהצלחה', 'success');
                } catch (err) {
                    console.error("Export failed", err);
                    showNotification('שגיאה', 'ייצוא הפרויקט נכשל', 'error');
                } finally {
                    setIsExporting(false);
                }
            };

            const handleUploadFiles = (e) => {
                const fileList = e.target.files;
                if (!fileList.length) return;
                
                const newFiles = {};
                Array.from(fileList).forEach(file => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        newFiles[file.name] = e.target.result;
                        
                        // אחרי שכל הקבצים נקראו
                        if (Object.keys(newFiles).length === fileList.length) {
                            setFiles(prev => ({ ...prev, ...newFiles }));
                            showNotification('העלאה', `${fileList.length} קבצים הועלו בהצלחה`, 'success');
                        }
                    };
                    reader.readAsText(file);
                });
                
                // נקה את הקלט
                e.target.value = '';
            };

            const handleSearchReplace = () => {
                if (!searchTerm) return;
                
                const currentContent = files[activeFile];
                if (!currentContent.includes(searchTerm)) {
                    showNotification('חיפוש', 'הטקסט לא נמצא', 'info');
                    return;
                }
                
                const newContent = replaceTerm 
                    ? currentContent.replace(new RegExp(searchTerm, 'g'), replaceTerm)
                    : currentContent;
                
                setFiles(prev => ({ ...prev, [activeFile]: newContent }));
                
                showNotification(
                    'החלפה', 
                    replaceTerm 
                        ? `הוחלפו ${currentContent.split(searchTerm).length - 1} מופעים`
                        : `נמצאו ${currentContent.split(searchTerm).length - 1} מופעים`,
                    'success'
                );
            };

            const handleRunCode = () => {
                if (!activeFile) return;
                
                if (activeFile.endsWith('.html')) {
                    const blob = new Blob([files[activeFile]], { type: 'text/html' });
                    const url = URL.createObjectURL(blob);
                    window.open(url, '_blank');
                    showNotification('הרצה', 'הקוד פותח בכרטיסייה חדשה', 'success');
                } else if (activeFile.endsWith('.js')) {
                    try {
                        // בודד הרצה למניעת בעיות אבטחה
                        const iframe = document.createElement('iframe');
                        iframe.style.display = 'none';
                        document.body.appendChild(iframe);
                        
                        const script = iframe.contentWindow.document.createElement('script');
                        script.textContent = files[activeFile];
                        iframe.contentWindow.document.body.appendChild(script);
                        
                        setTimeout(() => document.body.removeChild(iframe), 1000);
                        showNotification('הרצה', 'JavaScript הורץ בהצלחה', 'success');
                    } catch (err) {
                        showNotification('שגיאה', `שגיאה בהרצת הקוד: ${err.message}`, 'error');
                    }
                } else {
                    showNotification('מידע', 'הרצת קוד זמינה רק עבור HTML ו-JavaScript', 'info');
                }
            };

            const handleFormatCode = () => {
                if (!activeFile) return;
                
                const content = files[activeFile];
                let formatted = content;
                
                try {
                    if (activeFile.endsWith('.json')) {
                        formatted = JSON.stringify(JSON.parse(content), null, 2);
                    } else if (activeFile.endsWith('.js') || activeFile.endsWith('.css') || activeFile.endsWith('.html')) {
                        // פורמט בסיסי
                        formatted = content
                            .replace(/\s+/g, ' ')
                            .replace(/([{;])/g, '$1\n')
                            .replace(/}\s*/g, '}\n')
                            .replace(/\n\s*\n/g, '\n');
                    }
                    
                    setFiles(prev => ({ ...prev, [activeFile]: formatted }));
                    showNotification('פורמט', 'הקוד עוצב בהצלחה', 'success');
                } catch (err) {
                    showNotification('שגיאה', 'לא ניתן לעצב את הקוד', 'error');
                }
            };

            const handleCodeChange = (e) => {
                const newContent = e.target.value;
                setFiles(prev => ({ ...prev, [activeFile]: newContent }));
            };

            const toggleSplitView = () => {
                if (!splitView && Object.keys(files).length > 1) {
                    const otherFiles = Object.keys(files).filter(f => f !== activeFile);
                    setSecondaryFile(otherFiles[0]);
                }
                setSplitView(!splitView);
            };

            const getFileIcon = (filename) => {
                const ext = filename.split('.').pop().toLowerCase();
                const icons = {
                    'js': 'FileCode',
                    'jsx': 'FileCode',
                    'ts': 'FileCode',
                    'html': 'FileCode',
                    'css': 'FileCss',
                    'scss': 'FileCss',
                    'json': 'FileJson',
                    'md': 'FileText',
                    'txt': 'FileText',
                    'py': 'FileCode',
                    'php': 'FileCode',
                    'java': 'FileCode',
                    'cpp': 'FileCode',
                    'c': 'FileCode',
                    'go': 'FileCode'
                };
                return icons[ext] || 'File';
            };

            return (
                <div className="flex h-screen w-full bg-[#0d1117] overflow-hidden">
                    
                    {/* Activity Bar */}
                    <div className="hidden md:flex w-16 bg-[#161b22] border-l border-[#30363d] flex-col items-center py-6 gap-8">
                        <Icon name="Box" size={28} className="text-blue-500" />
                        <Icon 
                            name="Files" 
                            size={24} 
                            className="text-white cursor-pointer hover:bg-[#30363d] p-1 rounded"
                            onClick={() => setSidebarOpen(true)}
                        />
                        <Icon 
                            name="Search" 
                            size={24} 
                            className="text-[#8b949e] hover:text-white cursor-pointer hover:bg-[#30363d] p-1 rounded"
                            onClick={() => setSearchOpen(!searchOpen)}
                        />
                        <Icon 
                            name="Play" 
                            size={24} 
                            className="text-[#8b949e] hover:text-green-500 cursor-pointer hover:bg-[#30363d] p-1 rounded"
                            onClick={handleRunCode}
                        />
                        <Icon 
                            name="Split" 
                            size={24} 
                            className="text-[#8b949e] hover:text-white cursor-pointer hover:bg-[#30363d] p-1 rounded"
                            onClick={toggleSplitView}
                        />
                        <Icon 
                            name="Github" 
                            size={24} 
                            className="text-[#8b949e] hover:text-white cursor-pointer hover:bg-[#30363d] p-1 rounded"
                        />
                        <Icon 
                            name="Settings" 
                            size={24} 
                            className="text-[#8b949e] mt-auto hover:text-white cursor-pointer hover:bg-[#30363d] p-1 rounded"
                        />
                    </div>

                    {/* Sidebar */}
                    <aside className={`
                        fixed md:relative md:translate-x-0
                        sidebar-transition z-50
                        w-80 h-full bg-[#0d1117] border-l border-[#30363d]
                        flex flex-col
                        ${isSidebarOpen ? 'sidebar-visible right-0' : 'sidebar-hidden -right-80 md:right-0'}
                    `}>
                        {/* Sidebar Header */}
                        <div className="p-4 flex items-center justify-between border-b border-[#30363d]">
                            <span className="text-xs font-bold text-[#8b949e] uppercase tracking-wider">סייר קבצים</span>
                            <div className="flex gap-2">
                                <button 
                                    onClick={() => fileInputRef.current?.click()}
                                    className="p-1 hover:bg-[#30363d] rounded"
                                    title="העלאת קבצים"
                                >
                                    <Icon name="Upload" size={16} />
                                </button>
                                <button onClick={() => setSidebarOpen(false)} className="md:hidden p-1 hover:bg-[#30363d] rounded">
                                    <Icon name="X" size={20} />
                                </button>
                            </div>
                            <input
                                type="file"
                                ref={fileInputRef}
                                multiple
                                onChange={handleUploadFiles}
                                className="hidden"
                            />
                        </div>

                        {/* New File Input */}
                        <div className="p-4">
                            <div className="relative group">
                                <input 
                                    type="text"
                                    value={newFileName}
                                    onChange={(e) => setNewFileName(e.target.value)}
                                    onKeyDown={(e) => e.key === 'Enter' && handleCreateFile()}
                                    placeholder="שם קובץ חדש (לדוגמה: script.js)"
                                    className="w-full bg-[#161b22] border border-[#30363d] rounded py-2 px-3 text-sm ltr focus:border-blue-500 outline-none transition-all"
                                />
                                <button 
                                    onClick={handleCreateFile}
                                    className="absolute left-2 top-2 text-gray-500 hover:text-blue-400 p-1"
                                    title="צור קובץ חדש"
                                >
                                    <Icon name="Plus" size={16} />
                                </button>
                            </div>
                        </div>

                        {/* File List */}
                        <div className="flex-grow overflow-y-auto px-2 space-y-1 custom-scrollbar">
                            {Object.keys(files).sort().map(path => (
                                <div 
                                    key={path}
                                    onClick={() => {
                                        setActiveFile(path);
                                        if (window.innerWidth <= 768) setSidebarOpen(false);
                                    }}
                                    className={`
                                        group flex items-center justify-between p-3 rounded-md cursor-pointer transition-all
                                        ${activeFile === path ? 'bg-[#21262d] text-white shadow-sm' : 'hover:bg-[#161b22] text-[#8b949e]'}
                                        ${secondaryFile === path ? 'border-r-2 border-blue-500' : ''}
                                    `}
                                >
                                    <div className="flex items-center gap-3 truncate ltr">
                                        <Icon 
                                            name={getFileIcon(path)} 
                                            size={16} 
                                            className={activeFile === path ? 'text-blue-400' : 'text-[#484f58]'} 
                                        />
                                        <div className="flex flex-col">
                                            <span className="text-sm font-medium truncate">{path}</span>
                                            <span className="text-xs text-[#6e7681]">{getLanguage(path)}</span>
                                        </div>
                                    </div>
                                    <div className="flex items-center gap-1">
                                        {splitView && secondaryFile !== path && (
                                            <button 
                                                onClick={(e) => {
                                                    e.stopPropagation();
                                                    setSecondaryFile(path);
                                                }}
                                                className="opacity-0 group-hover:opacity-100 hover:text-blue-400 p-1"
                                                title="הצג בחלוקה"
                                            >
                                                <Icon name="SplitSquareVertical" size={14} />
                                            </button>
                                        )}
                                        <button 
                                            onClick={(e) => handleDeleteFile(path, e)}
                                            className="opacity-0 group-hover:opacity-100 hover:text-red-400 p-1"
                                            title="מחק קובץ"
                                        >
                                            <Icon name="Trash2" size={14} />
                                        </button>
                                    </div>
                                </div>
                            ))}
                        </div>

                        {/* Sidebar Footer */}
                        <div className="p-4 bg-[#161b22] border-t border-[#30363d] space-y-3">
                            <div className="text-xs text-[#8b949e] flex justify-between">
                                <span>סך קבצים: {Object.keys(files).length}</span>
                                <span>נפח: {JSON.stringify(files).length} בייט</span>
                            </div>
                            <button 
                                onClick={handleDownloadProject}
                                disabled={isExporting}
                                className="w-full bg-[#238636] hover:bg-[#2ea043] disabled:opacity-50 text-white text-sm font-bold py-2.5 rounded-md flex items-center justify-center gap-2 transition-colors"
                            >
                                {isExporting ? <Icon name="Loader2" size={18} className="animate-spin" /> : <Icon name="Download" size={18} />}
                                הורד פרויקט (ZIP)
                            </button>
                        </div>
                    </aside>

                    {/* Main Content */}
                    <div className="flex-grow flex flex-col min-w-0 bg-[#0d1117] relative">
                        
                        {/* Mobile Navbar */}
                        <div className="md:hidden flex h-14 bg-[#161b22] border-b border-[#30363d] items-center justify-between px-4">
                            <button onClick={() => setSidebarOpen(true)} className="p-2 text-white">
                                <Icon name="Menu" size={24} />
                            </button>
                            <span className="text-sm font-mono truncate px-4 ltr">{activeFile || 'לא נבחר קובץ'}</span>
                            <Icon name="Box" size={24} className="text-blue-500" />
                        </div>

                        {/* Top Toolbar */}
                        <div className="hidden md:flex bg-[#161b22] border-b border-[#30363d] px-4 py-2 items-center justify-between">
                            <div className="flex items-center gap-4">
                                <div className="flex items-center gap-2 text-sm ltr">
                                    <Icon name={getFileIcon(activeFile)} size={16} className="text-blue-400" />
                                    <span className="text-[#e6edf3] font-mono">{activeFile}</span>
                                    <span className="text-xs text-[#8b949e] px-2 py-1 bg-[#30363d] rounded">
                                        {getLanguage(activeFile)}
                                    </span>
                                </div>
                                {isSaving && (
                                    <div className="flex items-center gap-2 text-xs text-blue-400 animate-pulse">
                                        <Icon name="Cloud" size={12} />
                                        <span>שומר...</span>
                                    </div>
                                )}
                            </div>
                            
                            <div className="flex items-center gap-2">
                                {searchOpen && (
                                    <div className="flex items-center gap-2 bg-[#0d1117] border border-[#30363d] rounded px-3 py-1">
                                        <input
                                            type="text"
                                            value={searchTerm}
                                            onChange={(e) => setSearchTerm(e.target.value)}
                                            placeholder="חיפוש..."
                                            className="bg-transparent outline-none text-sm ltr w-32"
                                        />
                                        <input
                                            type="text"
                                            value={replaceTerm}
                                            onChange={(e) => setReplaceTerm(e.target.value)}
                                            placeholder="החלפה..."
                                            className="bg-transparent outline-none text-sm ltr w-32"
                                        />
                                        <button onClick={handleSearchReplace} className="text-blue-400 hover:text-blue-300">
                                            <Icon name="Replace" size={14} />
                                        </button>
                                        <button onClick={() => setSearchOpen(false)} className="text-gray-500 hover:text-gray-300">
                                            <Icon name="X" size={14} />
                                        </button>
                                    </div>
                                )}
                                
                                <button 
                                    onClick={() => setSearchOpen(!searchOpen)}
                                    className="p-2 hover:bg-[#30363d] rounded"
                                    title="חיפוש והחלפה (Ctrl+F)"
                                >
                                    <Icon name="Search" size={16} />
                                </button>
                                
                                <button 
                                    onClick={handleFormatCode}
                                    className="p-2 hover:bg-[#30363d] rounded"
                                    title="עצב קוד"
                                >
                                    <Icon name="Indent" size={16} />
                                </button>
                                
                                <button 
                                    onClick={handleRunCode}
                                    className="p-2 hover:bg-[#30363d] rounded text-green-500"
                                    title="הרץ קוד (Ctrl+R)"
                                >
                                    <Icon name="Play" size={16} />
                                </button>
                                
                                <button 
                                    onClick={toggleSplitView}
                                    className={`p-2 hover:bg-[#30363d] rounded ${splitView ? 'text-blue-400 bg-[#30363d]' : ''}`}
                                    title="מצב חלוקה"
                                >
                                    <Icon name="SplitSquareVertical" size={16} />
                                </button>
                            </div>
                        </div>

                        {/* Editor Area */}
                        <div className="flex-grow flex overflow-hidden">
                            {/* Primary Editor */}
                            <div className={`flex-grow ${splitView ? 'w-1/2 border-r border-[#30363d]' : 'w-full'}`}>
                                {activeFile ? (
                                    <div className="editor-container h-full">
                                        <textarea
                                            ref={editorRef}
                                            onChange={handleCodeChange}
                                            className="code-editor custom-scrollbar"
                                            spellCheck="false"
                                            autoFocus
                                            placeholder="// התחל לכתוב קוד כאן..."
                                        />
                                        <pre 
                                            ref={highlightRef}
                                            className={`code-highlight language-${getLanguage(activeFile)}`}
                                        />
                                    </div>
                                ) : (
                                    <div className="flex flex-col items-center justify-center h-full text-center p-10 opacity-20">
                                        <Icon name="Code2" size={80} className="mb-4" />
                                        <p className="text-xl">בחר קובץ מהתפריט הצידי כדי להתחיל</p>
                                        <p className="text-sm mt-2">או צור קובץ חדש באמצעות הכפתור למעלה</p>
                                    </div>
                                )}
                            </div>
                            
                            {/* Secondary Editor (Split View) */}
                            {splitView && secondaryFile && (
                                <div className="w-1/2 flex flex-col">
                                    <div className="h-10 bg-[#161b22] border-b border-[#30363d] px-4 flex items-center justify-between">
                                        <div className="flex items-center gap-2 text-sm ltr">
                                            <Icon name={getFileIcon(secondaryFile)} size={14} className="text-blue-400" />
                                            <span className="text-[#e6edf3] font-mono truncate">{secondaryFile}</span>
                                        </div>
                                        <button 
                                            onClick={() => setSecondaryFile('')}
                                            className="p-1 hover:bg-[#30363d] rounded"
                                        >
                                            <Icon name="X" size={14} />
                                        </button>
                                    </div>
                                    <div className="editor-container flex-grow">
                                        <textarea
                                            value={files[secondaryFile] || ''}
                                            onChange={(e) => setFiles(prev => ({ ...prev, [secondaryFile]: e.target.value }))}
                                            className="code-editor custom-scrollbar"
                                            spellCheck="false"
                                            placeholder="// קובץ משני..."
                                        />
                                        <pre className={`code-highlight language-${getLanguage(secondaryFile)}`}>
                                            <code className={`language-${getLanguage(secondaryFile)}`}>
                                                {files[secondaryFile] || ''}
                                            </code>
                                        </pre>
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* Status Bar */}
                        <div className="h-6 bg-[#007acc] text-white text-xs flex items-center px-3 justify-between">
                            <div className="flex items-center gap-3">
                                <span className="flex items-center gap-1 hover:bg-white/10 px-1 cursor-pointer">
                                    <Icon name="Wifi" size={10} /> מחובר
                                </span>
                                <span className="ltr">UTF-8</span>
                                <span className="hidden md:inline">ProCode IDE v2.0</span>
                            </div>
                            <div className="flex items-center gap-3 ltr">
                                <span>שורות: {files[activeFile]?.split('\n').length || 1}</span>
                                <span>תוים: {files[activeFile]?.length || 0}</span>
                                <span>{getLanguage(activeFile)}</span>
                                <Icon name="Keyboard" size={12} title="קיצורי מקלדת: Ctrl+S לשמירה, Ctrl+F לחיפוש, Ctrl+B להסתרת סרגל צד" />
                            </div>
                        </div>
                    </div>

                    {/* Notifications */}
                    {notification && (
                        <div className="fixed bottom-4 right-4 bg-[#21262d] border border-[#30363d] rounded-lg p-4 shadow-lg z-50 max-w-sm animate-slideUp">
                            <div className="flex items-center gap-3">
                                <Icon 
                                    name={notification.type === 'success' ? 'CheckCircle' : 
                                          notification.type === 'error' ? 'AlertCircle' : 'Info'} 
                                    className={notification.type === 'success' ? 'text-green-500' : 
                                              notification.type === 'error' ? 'text-red-500' : 'text-blue-500'} 
                                    size={20}
                                />
                                <div>
                                    <p className="font-medium">{notification.title}</p>
                                    <p className="text-sm text-[#8b949e]">{notification.message}</p>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Overlay for Mobile Sidebar */}
                    {isSidebarOpen && window.innerWidth <= 768 && (
                        <div 
                            className="fixed inset-0 bg-black/50 z-40 transition-opacity"
                            onClick={() => setSidebarOpen(false)}
                        />
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
                                        </html>
